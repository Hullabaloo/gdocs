## Текст тестового задания


Ваши партнеры скидывают аналитику по продажам в GoogleDrive 1 партнер - 1 файл в день

название файла partnerName_10.09.2020.*

partnerName - название партнера (может содержать кириллицу, латиницу, символы - ",',')
10.09.2020 - дата за которую предоставлен отчет
Формат файла - гугл таблицы или CSV

Структура файла:
Дата и время заказы | Имя клиента | Наименование товара\услуги |  количество | Стоимость за единицу | Тип доставки (курьер/самовывоз) | Город доставки | стоимость доставки курьером | Итого стоимость |

(!) Количество ваших партнеров не ограничено

Необходимо написать CLI Приложение на symfony, подключаемы к GoogleDrive (Sheet), 
- выкачивает ранее не загруженные файлы и помещает их в БД. 
- Обработанные файлы помещаются в директорию archive которая лежит рядом с директорией upload.
- Если структура файла нарушена, его необходимо помещать в директорию invalid.

Уточнения к реализации:
- Необходимо самостоятельно реализовать компонент работы с GoogleDrive а не использовать готовые библиотеки, - реализовать его как сервис, с возможностью указать параметры подключение, 
- параметры подключений должны быть вынесены в .env

cli+

# Инструкции по реализации
## Создание сервисного аккаунта и получение файла ключей
1. Откройте страницу Сервисные аккаунты. При необходимости выберите или создайте проект.
   https://console.developers.google.com/iam-admin/serviceaccounts
2. Нажмите Создать сервисный аккаунт.
3. Укажите название аккаунта и выберите Создать новый закрытый ключ.
4. Скачайте и сохраните ключ в формате JSON, из которого нам понадобятся
поля "private_key" и "client_email"
5. Откройте страницу библиотек API и подключите GoogleDrive API к созданному проекту (проект должен быть выбран)
   https://console.cloud.google.com/apis/library
6. Откройте GoogleDrive и создайте любую папку (напр. clientDocs), после чего откройте доступ с правами редактора
к этой папке для пользователя "client_email" из файла ключей (прим. gdocs-1128@gdocs-333107.iam.gserviceaccount.com)
   
   После перейдите в созданную папку (clientDocs) и создайте внутри 3 папки со следующими названиями:
   * upload
   * invalid
   * archive
   
   Клиенты должны загружать новые файлы только в папку "upload". Для этого клиентам необходимо дать доступ только к папке "upload".
   
   https://drive.google.com/drive/my-drive


## Установка и запуск

* скачайте или клонируйте репозиторий
    - https://github.com/Hullabaloo/gdocs.git

* установите зависимости и запустите контейнер, находясь в корневой папке приложения
    - composer install
    - docker-compose up
* зайти в контейнер php через команду "docker exec -it _containerID_ /bin/bash", 
  после чего выполните следующие команды для создания таблиц в БД
  - cd /srv/www/gdocs
  - php bin/console doctrine:migrations:migrate
* укажите в .env файле параметры из файла ключа
   - GOOGLE_SERVICEACC_EMAIL - адрес электронной почты сервисного аккаунта - поле client_email
   - GOOGLE_SERVICEACC_KEY - ключ (строка) - поле private_key
* в конечном итоге загрузите необходимые тестовые (файлы можно взять в папке testdata) файлы в папку upload на GoogleDrive и выполните следующую команду
   - php bin/console app:gdocs


## Условия и особенности работы приложения

* Корректное название файлов partnerName_10.09.2020.*
    - partnerName - название партнера (может содержать кириллицу, латиницу, символы - ",',')
    - несоответствие названию означает перемещение файла в папку invalid
* Разделитель полей установлен по-умолчанию как знак "," (указывается в .env)
    - Данный разделить выбран по причине того, что требуется экспорт google-sheet документов в CSV формат для более удобной обработки, полученный документ так же использует в качестве разделителя знак ","
* Несоответствие файлов типу mimeType, имени файла или несоответствие контента (набор полей в файле!=требуему количеству) означает перемещение файла в папку invalid     


## Возможные доработки
- работа с большим количеством файлов (пагинация при запросе)
- работа с большими файлами (долгое время обработки)
- проверка валидности токена (время жизни), в случае неработоспособности токена, генерировать новый
- google sheet файлы - лимит на экспорт 10мб
- хранить лог скачанных файлов
- обработка файлов CSV с различными разделителями, сейчас необходимо указать 
  единственно возможный разделитель в .env, файлы с иными разделителями считаются "битыми"
- валидация полей в CSV файле (например корректность dateTime)  